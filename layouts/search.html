{{ define "main" }}
<div class="search-page">
    <header class="page-header">
        <h1>{{ .Title }}</h1>
        {{ if .Content }}
        <div class="page-content">
            {{ .Content }}
        </div>
        {{ end }}
    </header>

    {{/* Enhanced search interface */}}
    <div class="search-interface">
        <div class="search-box">
            <input type="text" id="main-search-input" placeholder="Search articles, tags, concepts..." class="main-search-input">
            <button id="search-button" class="search-button">Search</button>
        </div>
        
        <div class="search-filters">
            <div class="filter-group">
                <label for="tag-filter">Filter by Tags:</label>
                <select id="tag-filter" class="filter-select">
                    <option value="">All Tags</option>
                    {{ range $name, $taxonomy := .Site.Taxonomies.tags }}
                    <option value="{{ $name }}">{{ $name }} ({{ len $taxonomy.Pages }})</option>
                    {{ end }}
                </select>
            </div>
            
            <div class="filter-group">
                <label for="concept-filter">Filter by Concepts:</label>
                <select id="concept-filter" class="filter-select">
                    <option value="">All Concepts</option>
                    {{ range $name, $taxonomy := .Site.Taxonomies.concepts }}
                    <option value="{{ $name }}">{{ $name }} ({{ len $taxonomy.Pages }})</option>
                    {{ end }}
                </select>
            </div>
            
            <div class="filter-group">
                <label for="date-filter">Filter by Date:</label>
                <select id="date-filter" class="filter-select">
                    <option value="">All Time</option>
                    <option value="2025">2025</option>
                    <option value="2024">2024</option>
                    <option value="2023">2023</option>
                </select>
            </div>
        </div>
    </div>

    {{/* Search results container */}}
    <div id="search-results-container" class="search-results-container">
        <div class="results-header">
            <h2>Search Results</h2>
            <div id="results-count" class="results-count">No search performed yet</div>
        </div>
        <div id="search-results-list" class="search-results-list">
            <!-- Results will be populated by JavaScript -->
        </div>
    </div>

    {{/* Popular searches */}}
    <div class="popular-searches">
        <h3>Popular Searches</h3>
        <div class="search-tags">
            {{ range first 10 .Site.Taxonomies.tags.ByCount }}
            <a href="{{ "/tags/" | relURL }}{{ .Term | urlize }}" class="search-tag">{{ .Term }}</a>
            {{ end }}
        </div>
    </div>
</div>

{{/* Include search JavaScript */}}
<script src="{{ "js/search.js" | relURL }}"></script>
<script>
// Enhanced search page functionality
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('main-search-input');
    const searchButton = document.getElementById('search-button');
    const tagFilter = document.getElementById('tag-filter');
    const conceptFilter = document.getElementById('concept-filter');
    const dateFilter = document.getElementById('date-filter');
    const resultsContainer = document.getElementById('search-results-list');
    const resultsCount = document.getElementById('results-count');
    
    let currentResults = [];
    
    // Perform search
    function performSearch() {
        const query = searchInput.value.trim();
        const tag = tagFilter.value;
        const concept = conceptFilter.value;
        const date = dateFilter.value;
        
        if (!query && !tag && !concept && !date) {
            resultsContainer.innerHTML = '<p class="no-search">Enter a search term or select filters to see results.</p>';
            resultsCount.textContent = 'No search performed yet';
            return;
        }
        
        // This would integrate with the main search engine
        // For now, show a placeholder
        resultsContainer.innerHTML = '<p class="searching">Searching...</p>';
        
        // Simulate search (replace with actual implementation)
        setTimeout(() => {
            resultsContainer.innerHTML = '<p class="no-results">Search functionality will be implemented with the full build.</p>';
            resultsCount.textContent = 'Search results will appear here';
        }, 1000);
    }
    
    // Event listeners
    searchButton.addEventListener('click', performSearch);
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            performSearch();
        }
    });
    
    [tagFilter, conceptFilter, dateFilter].forEach(filter => {
        filter.addEventListener('change', performSearch);
    });
    
    // Initialize
    performSearch();
});
</script>
{{ end }}
